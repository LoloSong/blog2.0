{
    "version": 3,
    "sources": [
        "../../../../src/admin/service/import/markdown.js"
    ],
    "names": [
        "PATH",
        "join",
        "think",
        "RUNTIME_PATH",
        "_think",
        "user",
        "category",
        "tag",
        "post",
        "posts",
        "Array",
        "isArray",
        "postsPromise",
        "map",
        "item",
        "session",
        "title",
        "pathname",
        "markdown_content",
        "create_time",
        "formatDate",
        "Date",
        "created_at",
        "update_time",
        "updated_at",
        "status",
        "user_id",
        "id",
        "comment_num",
        "allow_comment",
        "is_public",
        "type",
        "model",
        "getContentAndSummary",
        "postModelInstance",
        "addPost",
        "console",
        "log",
        "all",
        "length",
        "page",
        "parseFile",
        "file",
        "filePath",
        "path",
        "replace",
        "files",
        "readdirSync",
        "encoding",
        "tar",
        "split",
        "slice",
        "content",
        "readFileSync",
        "stat",
        "statSync",
        "birthtime",
        "getTime",
        "mtime",
        "e",
        "Error",
        "run",
        "importData"
    ],
    "mappings": "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",
    "file": "../../../../src/admin/service/import/markdown.js",
    "sourcesContent": [
        "import fs from 'fs';\nimport path from 'path';\nimport {execSync} from 'child_process';\nimport Base from './base';\n\nconst PATH = path.join(think.RUNTIME_PATH, 'importMarkdownFileToFirekylin');\nexport default class extends Base {\n  constructor(think) {\n    super(think);\n    this._think = think;\n  }\n  /**\n   * 导入用户\n   */\n  async user() {\n    return 0;\n  }\n\n  /**\n   * 导入分类\n   */\n  async category() {\n    return 0;\n  }\n\n  /**\n   * 导入标签\n   */\n  async tag() {\n    return 0;\n  }\n\n  /**\n   * 导入文章\n   */\n  async post(posts = []) {\n    if(!Array.isArray(posts)) {\n      return 0;\n    }\n\n\n    const postsPromise = posts.map(async item => {\n      try{\n        //获取用户\n        const user = await this._think.session('userInfo');\n\n        let post = {\n          title: item.title,\n          pathname: item.pathname,\n          markdown_content: item.markdown_content,\n          create_time: this.formatDate(new Date(item.created_at)),\n          update_time: this.formatDate(new Date(item.updated_at)),\n          status: 3,\n          user_id: user.id,\n          comment_num: 0,\n          allow_comment: 1,\n          is_public: 1,\n          type: 0\n        };\n        post = await think.model('post', null, 'admin').getContentAndSummary(post);\n        await this.postModelInstance.addPost(post);\n      } catch(e) {\n        console.log(e);  // eslint-disable-line no-console\n      }\n    });\n    Promise.all(postsPromise);\n\n    return posts.length;\n  }\n\n  /**\n   * 导入页面\n   */\n  async page() {\n    return 0;\n  }\n\n  parseFile(file) {\n    try {\n      const filePath = file.path.replace(/[^a-zA-Z0-9.\\/_-]/g, '');\n      execSync(`rm -rf ${PATH}; mkdir ${PATH}; cd ${PATH}; tar zxvf \"${filePath}\"`);\n      let files = fs.readdirSync(PATH, {encoding: 'utf-8'});\n      if(!files.length) { return []; }\n\n      return files.map(function(file) {\n        let tar = path.join(PATH, file);\n        let title = file.split('.').slice(0, -1).join('');\n        let content = fs.readFileSync(tar, {encoding: 'utf-8'});\n        let stat = fs.statSync(tar);\n        return {\n          created_at: stat.birthtime.getTime(),\n          updated_at: stat.mtime.getTime(),\n          title,\n          pathname: title,\n          markdown_content: content\n        };\n      });\n    } catch(e) {\n      throw new Error(e);\n    }\n  }\n\n  /**\n   * 执行导入\n   */\n  async run(file) {\n    return await this.importData(this.parseFile(file));\n  }\n}\n"
    ]
}