{
    "version": 3,
    "sources": [
        "../../../src/home/controller/base.js"
    ],
    "names": [
        "init",
        "http",
        "HOME_VIEW_PATH",
        "think",
        "ROOT_PATH",
        "sep",
        "__before",
        "action",
        "firekylin",
        "isInstalled",
        "redirect",
        "model",
        "getOptions",
        "options",
        "navigation",
        "themeConfig",
        "JSON",
        "parse",
        "e",
        "commentConfigName",
        "comment",
        "name",
        "githubPassWord",
        "assign",
        "version",
        "theme",
        "THEME_VIEW_PATH",
        "siteUrl",
        "site_url",
        "host",
        "getCateArchive",
        "categories",
        "tagModel",
        "getTagArchive",
        "tagList",
        "postModel",
        "getLastPostList",
        "lastPostList",
        "Date",
        "getFullYear",
        "displayView",
        "url",
        "match",
        "jsonOutput",
        "assignObj",
        "forEach",
        "key",
        "indexOf",
        "type",
        "end",
        "display",
        "controller",
        "base"
    ],
    "mappings": "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",
    "file": "../../../src/home/controller/base.js",
    "sourcesContent": [
        "'use strict';\nimport pack from '../../../package.json';\n\nexport default class extends think.controller.base {\n  /**\n   * init\n   * @param  {[type]} http [description]\n   * @return {[type]}      [description]\n   */\n  init(http) {\n    super.init(http);\n    //home view path\n    this.HOME_VIEW_PATH = `${think.ROOT_PATH}${think.sep}view${think.sep}home${think.sep}`;\n  }\n  /**\n   * some base method in here\n   */\n  async __before() {\n    if (this.http.action === 'install') {\n      return;\n    }\n    if (!firekylin.isInstalled) {\n      return this.redirect('/index/install');\n    }\n\n    let model = this.model('options');\n    let options = await model.getOptions();\n    this.options = options;\n    let {\n      navigation,\n      themeConfig\n    } = options;\n    try {\n      navigation = JSON.parse(navigation);\n    } catch (e) {\n      navigation = [];\n    }\n    try {\n      themeConfig = JSON.parse(themeConfig);\n    } catch (e) {\n      themeConfig = {};\n    }\n\n    //remove github pwd\n    let commentConfigName = {};\n    try {\n      commentConfigName = JSON.parse(options.comment.name);\n      delete commentConfigName.githubPassWord;\n      options.comment.name = JSON.stringify(commentConfigName);\n    } catch (e) {\n      commentConfigName = {}\n    }\n\n    this.assign('options', options);\n    this.assign('navigation', navigation);\n    this.assign('themeConfig', themeConfig);\n    this.assign('VERSION', pack.version);\n    //set theme view root path\n    let theme = options.theme || 'firekylin';\n    this.THEME_VIEW_PATH = `${think.ROOT_PATH}${think.sep}www${think.sep}theme${think.sep}${theme}${think.sep}`;\n\n    //网站地址\n    let siteUrl = this.options.site_url;\n    if (!siteUrl) {\n      siteUrl = 'http://' + this.http.host;\n    }\n    this.assign('site_url', siteUrl);\n\n    //所有的分类\n    let categories = await this.model('cate').getCateArchive();\n    this.assign('categories', categories);\n\n    // 所有标签\n    let tagModel = this.model('tag');\n    let tagList = await tagModel.getTagArchive();\n    this.assign('tags', tagList);\n\n    // 最近10条文章\n    let postModel = this.model('post');\n    let lastPostList = await postModel.getLastPostList();\n    this.assign('lastPostList', lastPostList);\n\n    this.assign('currentYear', (new Date()).getFullYear());\n  }\n  /**\n   * display view page\n   * @param  {} name []\n   * @return {}      []\n   */\n  async displayView(name) {\n    if (this.http.url.match(/\\.json(?:\\?|$)/)) {\n      let jsonOutput = {},\n        assignObj = this.assign();\n      Object.keys(assignObj).forEach((key) => {\n        if (['controller', 'http', 'config', '_', 'options'].indexOf(key) === -1) {\n          jsonOutput[key] = assignObj[key];\n        }\n      })\n\n      this.type('application/json');\n      return this.end(jsonOutput);\n    }\n\n    return this.display(this.THEME_VIEW_PATH + name + '.html');\n  }\n}\n"
    ]
}